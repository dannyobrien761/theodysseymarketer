{% extends 'base.html' %}
{% block extra_title %}Dashboard{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4 text-center">Welcome, {{ user.first_name|default:user.username }}</h2>

  {% if subscription %}
    <div class="card shadow-sm mx-auto" style="max-width: 600px;">
      <div class="card-body">
        <h5 class="card-title"><strong>Your Plan:</strong> {{ plan_name|default:"Unknown Plan" }}</h5>
        <p><strong> Status: </strong>
         {% if subscription.status == 'active' %}
          <span class="badge badge-success">Active</span>
         {% elif subscription.status == 'canceled' %}
          <span class="badge badge-warning">Canceled (ends {{ end_date|default:"unknown" }})</span>
         {% elif subscription.status == 'expired' %}
          <span class="badge badge-secondary">Expired</span>
         {% endif %}
      </p>

      {% if subscription.status == 'active' %}
        <p>âœ… Your subscription is active.</p>
        <a href="{% url 'subscriptions:cancel' %}" class="btn btn-danger">Cancel Subscription</a>
      {% elif subscription.status == 'canceled' %}
        <p>âŒ Youâ€™ve canceled; your subscription will remain active until <strong>{{ end_date|default:"unknown" }}</strong>.</p>
      {% elif subscription.status == 'expired' %}
        <p>ğŸ’¬ Your subscription has ended. <a href="{% url 'subscriptions:pricing' %}">Renew now</a>.</p>
      {% endif %}

      <hr>
      <p class="text-muted"><small></small>>Stripe Subscription ID: {{ subscription.stripe_subscription_id }}</p>
      </div>
    </div>
  {% else %}
    <p>You donâ€™t have an active subscription.</p>
    <a href="{% url 'subscriptions:pricing' %}" class="btn btn-primary">View Plans</a>
  {% endif %}
</div>

<section class="container mt-5">
  <div class="card shadow-sm mx-auto" style="max-width: 600px;">
    <div class="card-body text-center">
      <h5 class="card-title">Manage Your Billing</h5>
      <p class="card-text">
        Access your secure billing portal to:
        <ul class="text-left mt-3">
          <li>ğŸ” Update your subscription plan</li>
          <li>ğŸ’³ Change or update your payment method</li>
          <li>ğŸ“„ View and download past invoices</li>
          <li>ğŸ“¬ Update billing address and contact info</li>
          <li>âŒ Cancel your subscription</li>
        </ul>
      </p>
      <a href="{% url 'subscriptions:billing-portal' %}" class="btn btn-primary mt-3">Open Billing Portal</a>
    </div>
  </div>
</section>
{% endblock %}
